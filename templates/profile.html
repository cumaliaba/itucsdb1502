{%extends "layout.html"%}

{%block title%}Users{%endblock%}
{%block content%}
    {%if error%}<p>{{error}}</p>{%endif%}

    {%if 'username' in session and user.username == session['username']%}
        <h1>Welcome {{session['username']}}</h1>
        <p>Last login: {{g.lastlogin}}</p>
        <script>
	$(function() {
	    $('#button').click(function() {
		document.getElementById("test").innerHTML = "clicked";
		
		var user = $('#username').val();
		var pass = $('#password').val();
		$.ajax({
            url: '/updateUser',
		    data: $('form').serialize(),
		    type: 'POST',
		    success: function(response) {
			console.log(response);
		    },
		    error: function(error) {
			console.log(error);
		    }
		});
	    });
	});

        </script>
        <button id="button">Change Profile</button>
        <p id="test"></p>
        <form>
        <p><b>Username:</b> <input type="text" name="username" value={{user.username}} id="username"></p>
        <p><b>OldPassword:</b> <input type="password" name="password" id="password"></p>
        <p><b>New Password:</b> <input type="password" name="passwordnew" id="passwordnew"></p>
        <p><b>Email:</b> <input type="text" name="email" value={{user.email}} id="email"></p>
        <p><b>Role :</b> {{user.role}}</p>
        <p><b>Last Login:</b> {{user.lastlogin}}</p>
        <p><b>Registered Time:</b> {{user.regtime}}</p>
        </form>
    {%else%}
        <h1>You have no permission to see this pages content!</h1>
        <h1>Go to login page to sign in using this link</h1>
        <h1><a href="{{url_for('admin')}}">Login</a></h1>
    {%endif%}
{%endblock%}
